FUNCTION ZA_SELECT_ORDERLIST_C1.
*"----------------------------------------------------------------------
*"*"Local interface:
*"  IMPORTING
*"     VALUE(I_CNAME) TYPE  ZAE_CNAME OPTIONAL
*"     VALUE(I_ONUMB) TYPE  ZAE_ONUMB OPTIONAL
*"     VALUE(I_ODAYA_FROM) TYPE  ZAE_ODAYA OPTIONAL
*"     VALUE(I_ODAYA_TO) TYPE  ZAE_ODAYA OPTIONAL
*"     VALUE(I_SCPID) TYPE  ZAE_SCPID OPTIONAL
*"     VALUE(I_MYCHECK) TYPE  BOOLEAN OPTIONAL
*"     VALUE(I_FIRST) TYPE  BOOLEAN OPTIONAL
*"  EXPORTING
*"     VALUE(E_MSG) TYPE  MSG
*"     VALUE(E_RESULT) TYPE  RESULT
*"  TABLES
*"      T_OLIST STRUCTURE  ZOLIST_VW
*"----------------------------------------------------------------------

  "RANGES 값 설정
  RANGES:
  LR_CNAME FOR ZASDT0010-CNAME,
  LR_ONUMB FOR ZASDT0050-ONUMB,
  LR_ODAYA FOR ZASDT0050-ODAYA,
  LR_SCPID FOR ZAPST0020-SCPID.
  "변수 설정
  DATA: LV_CNT TYPE CHAR10.

  DATA: LV_HNAME TYPE ZASDT0030-HNAME.

  DATA: LT_DD07V TYPE TABLE OF DD07V WITH HEADER LINE.

  IF I_FIRST = ABAP_TRUE.

    LR_ODAYA-SIGN ='I'.
    LR_ODAYA-OPTION ='BT'.
    LR_ODAYA-LOW = SY-DATUM - 7.
    LR_ODAYA-HIGH = SY-DATUM.
    APPEND LR_ODAYA.

  ELSE.

    IF I_ODAYA_FROM IS NOT INITIAL.
      IF I_ODAYA_TO IS NOT INITIAL.
        LR_ODAYA-SIGN ='I'.
        LR_ODAYA-OPTION ='BT'.
        LR_ODAYA-LOW = I_ODAYA_FROM.
        LR_ODAYA-HIGH = I_ODAYA_TO.
        APPEND LR_ODAYA.

      ELSE.
        LR_ODAYA-SIGN ='I'.
        LR_ODAYA-OPTION ='EQ'.
        LR_ODAYA-LOW = I_ODAYA_FROM.
        APPEND LR_ODAYA.
      ENDIF.

    ELSEIF  I_ODAYA_TO IS NOT INITIAL.
      LR_ODAYA-SIGN ='I'.
      LR_ODAYA-OPTION ='EQ'.
      LR_ODAYA-LOW = I_ODAYA_TO.
      APPEND LR_ODAYA.
    ENDIF.


  ENDIF.

  IF I_MYCHECK EQ 'X'.
    LR_SCPID-SIGN = 'I'.
    LR_SCPID-OPTION ='EQ'.
    LR_SCPID-LOW = I_SCPID.
    APPEND LR_SCPID.
  ENDIF.

  IF I_CNAME IS NOT INITIAL.
    LR_CNAME-SIGN ='I'.
    LR_CNAME-OPTION ='CP'.
    LR_CNAME-LOW = '*' && I_CNAME && '*'.
    APPEND LR_CNAME.
  ENDIF.

  "주문번호 RANGE 설정
  IF I_ONUMB IS NOT INITIAL.
    LR_ONUMB-SIGN ='I'.
    LR_ONUMB-OPTION ='EQ'.
    LR_ONUMB-LOW = I_ONUMB.
    APPEND LR_ONUMB.
  ENDIF.

  CLEAR: T_OLIST.

  SELECT
  B~ONUMB, B~ENUMB, B~ODAYA, A~CNAME, C~ENAME, B~OSTAT, A~CNUMB, MAX( D~OTURN ) AS OTURN "E~HNAME,, B~OSTAT, A~CNUMB
  INTO CORRESPONDING FIELDS OF TABLE @T_OLIST
  FROM ZASDT0010 AS A JOIN ZASDT0050 AS B ON A~CNUMB EQ B~CNUMB
                      JOIN ZAPST0020 AS C ON B~ENUMB EQ C~ENUMB
                      JOIN ZASDT0060 AS D ON B~ONUMB EQ D~ONUMB
                      JOIN ZASDT0030 AS E ON E~HCODE EQ D~HCODE
  WHERE A~CNAME IN @LR_CNAME
  AND B~ONUMB IN @LR_ONUMB
  AND B~ODAYA IN @LR_ODAYA
  AND C~SCPID IN @LR_SCPID
  GROUP BY B~ONUMB, B~ENUMB, B~ODAYA, A~CNAME, C~ENAME, B~OSTAT, A~CNUMB
    ORDER BY B~ONUMB DESCENDING.



  CLEAR: LV_HNAME.


  LOOP AT T_OLIST.

    SELECT SINGLE E~HNAME
    INTO LV_HNAME
    FROM ZASDT0010 AS A JOIN ZASDT0050 AS B ON A~CNUMB EQ B~CNUMB
                        JOIN ZAPST0020 AS C ON B~ENUMB EQ C~ENUMB
                        JOIN ZASDT0060 AS D ON B~ONUMB EQ D~ONUMB
                        JOIN ZASDT0030 AS E ON E~HCODE EQ D~HCODE
    WHERE B~ONUMB = T_OLIST-ONUMB
    AND D~OTURN = T_OLIST-OTURN.

    IF SY-SUBRC = 0.
*      CONCATENATE LV_HNAME ` 등 ` T_OLIST-OTURN '채' INTO LV_HNAME2.
*      T_OLIST-HNAME = LV_HNAME2.
      IF T_OLIST-OTURN = '1'.
        T_OLIST-HNAME = LV_HNAME.
      ELSE.
        T_OLIST-HNAME = LV_HNAME && ' 등 ' && T_OLIST-OTURN &&' '&& '채'.
      ENDIF.
      MODIFY T_OLIST.
    ENDIF.

    CLEAR: LV_HNAME.
  ENDLOOP.


  CALL FUNCTION 'DD_DOMVALUES_GET'
    EXPORTING
      DOMNAME        = 'ZAD_OSTAT'
      TEXT           = 'X'
      LANGU          = SY-LANGU
    TABLES
      DD07V_TAB      = LT_DD07V
    EXCEPTIONS
      WRONG_TEXTFLAG = 1
      OTHERS         = 2.

  LOOP AT T_OLIST.
    READ TABLE LT_DD07V WITH KEY DOMVALUE_L = T_OLIST-OSTAT.
    IF SY-SUBRC EQ 0.
      T_OLIST-OSTAT = LT_DD07V-DDTEXT.
    ENDIF.

    MODIFY T_OLIST .
  ENDLOOP.

  IF T_OLIST[] IS NOT INITIAL.
    E_RESULT = 'S'.
    E_MSG = |{ LINES( T_OLIST[] ) }건이 조회되었습니다.|.
  ELSE.
    E_MSG = ' 데이터가 없습니다.'.
    E_RESULT = 'E'.
  ENDIF.







*
*      SELECT CNUMB
*      INTO TABLE LT_SUB
*      FROM ZASDT0010 AS A JOIN ZAPST0020 AS B
*      ON A~ENUMB EQ B~ENUMB
*      WHERE B~SCPID EQ I_SCPID.
*
*      LOOP AT LT_SUB.
*        SELECT B~ONUMB, B~ODAYA, A~CNAME, C~ENAME, B~OSTAT, A~CNUMB, MAX( D~OTURN ) AS OTURN
*        INTO CORRESPONDING FIELDS OF TABLE @LT_VIEW
*        FROM ZASDT0010 AS A JOIN ZASDT0050 AS B ON A~CNUMB EQ B~CNUMB
*                            JOIN ZAPST0020 AS C ON A~ENUMB EQ C~ENUMB
*                            JOIN ZASDT0060 AS D ON B~ONUMB EQ D~ONUMB
*                            JOIN ZASDT0030 AS E ON E~HCODE EQ D~HCODE
*        WHERE A~CNUMB = @LT_SUB-CNUMB
*        AND B~ODAYA IN @LR_ODAYA
*        GROUP BY B~ONUMB, B~ODAYA, A~CNAME, C~ENAME, B~OSTAT, A~CNUMB.
*
*        LOOP AT LT_VIEW.
*          MOVE-CORRESPONDING LT_VIEW TO T_OLIST.
*
*          APPEND T_OLIST.
*        ENDLOOP.
*
*      ENDLOOP.
*
*      LOOP AT T_OLIST.
*
*        SELECT SINGLE E~HNAME
*        INTO LV_HNAME
*        FROM ZASDT0010 AS A JOIN ZASDT0050 AS B ON A~CNUMB EQ B~CNUMB
*                            JOIN ZAPST0020 AS C ON A~ENUMB EQ C~ENUMB
*                            JOIN ZASDT0060 AS D ON B~ONUMB EQ D~ONUMB
*                            JOIN ZASDT0030 AS E ON E~HCODE EQ D~HCODE
*        WHERE B~ONUMB = T_OLIST-ONUMB
*        AND D~OTURN = T_OLIST-OTURN.
*
*        CONCATENATE LV_HNAME ` 등 ` T_OLIST-OTURN '채' INTO LV_HNAME2
*                    SEPARATED BY SPACE.
*
*        T_OLIST-HNAME = LV_HNAME2.
*
*        MODIFY T_OLIST.
*
*      ENDLOOP.

ENDFUNCTION.

-----------------------------------------------------------
Extracted by Mass Download version1.5.2 - E.G.Mellodew. 1998-2019. Sap Release753
